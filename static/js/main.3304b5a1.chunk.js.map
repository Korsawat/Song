{"version":3,"sources":["spotify.js","App.js","reportWebVitals.js","index.js"],"names":["loginUrl","concat","join","getTokenFromUrl","window","location","hash","substring","split","reduce","initial","item","parts","decodeURIComponent","App","token","setToken","useState","songs","setSongs","pairs","setPairs","currentPair","setCurrentPair","progress","setProgress","showRankings","setShowRankings","player","setPlayer","deviceId","setDeviceId","useEffect","_token","access_token","async","offset","allSongs","data","response","fetch","headers","Authorization","ok","Error","status","json","items","total","map","song","track","compared","wins","error","console","getLikedSongs","then","initialPairs","generatePairs","pickRandomPair","script","document","createElement","src","body","appendChild","onSpotifyWebPlaybackSDKReady","Spotify","Player","name","getOAuthToken","cb","addListener","_ref","device_id","log","_ref2","connect","totalSongs","length","comparedSongs","filter","i","j","push","remainingPairs","pair","randomIndex","Math","floor","random","handleChoice","winner","loser","updatedSongs","id","React","className","Fragment","rankSongs","ranked","sort","a","b","rank","forEach","index","key","onClick","album","images","url","alt","style","width","round","handleTie","showRankedSongs","href","reportWebVitals","onPerfEntry","Function","__webpack_require__","e","bind","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","createRoot","getElementById","render","StrictMode"],"mappings":"oLAEA,MAOaA,EAAQ,GAAAC,OAPC,yCAOkB,eAAAA,OALtB,mCAK6C,kBAAAA,OAN1C,mCAMuE,WAAAA,OAJ7E,CACb,qBAG2GC,KAC3G,OACD,yCAEYC,EAAkBA,IACtBC,OAAOC,SAASC,KAAKC,UAAU,GAAGC,MAAM,KAAKC,OAAO,CAACC,EAASC,KACnE,IAAIC,EAAQD,EAAKH,MAAM,KAEvB,OADAE,EAAQE,EAAM,IAAMC,mBAAmBD,EAAM,IACtCF,GACN,UCyNUI,MAvOHA,KACV,MAAOC,EAAOC,GAAYC,mBAAS,KAC5BC,EAAOC,GAAYF,mBAAS,KAC5BG,EAAOC,GAAYJ,mBAAS,KAC5BK,EAAaC,GAAkBN,mBAAS,CAAC,KAAM,QAC/CO,EAAUC,GAAeR,mBAAS,IAClCS,EAAcC,GAAmBV,oBAAS,IAC1CW,EAAQC,GAAaZ,mBAAS,OAC9Ba,EAAUC,GAAed,mBAAS,IAEzCe,oBAAU,KACR,MAAM1B,EAAOH,IACbC,OAAOC,SAASC,KAAO,GACvB,MAAM2B,EAAS3B,EAAK4B,aACpB,GAAID,EAAQ,CACVjB,EAASiB,GDEcE,WAE3B,IAAIC,EAAS,EACTC,EAAW,GAEf,IACE,IAAIC,EAEJ,EAAG,CACD,MAAMC,QAAiBC,MAAK,8CAAAvC,OARlB,GAQsE,YAAAA,OAAWmC,GAAU,CACnGK,QAAS,CACPC,cAAa,UAAAzC,OAAYc,MAI7B,IAAKwB,EAASI,GACZ,MAAM,IAAIC,MAAK,uBAAA3C,OAAwBsC,EAASM,SAGlDP,QAAaC,EAASO,OACtBT,EAAW,IAAIA,KAAaC,EAAKS,OACjCX,GApBU,SAqBHA,EAASE,EAAKU,OAEvB,OAAOX,EAASY,IAAKC,IAAI,CACvBC,MAAOD,EAAKC,MACZC,UAAU,EACVC,KAAM,KAER,MAAOC,GAEP,MADAC,QAAQD,MAAM,8BAA+BA,GACvCA,IChCJE,CAAcvB,GAAQwB,KAAMvC,IAC1BC,EAASD,EAAM+B,IAAKC,IAAI,IAAWA,EAAME,UAAU,MACnD3B,EAAY,GACZ,MAAMiC,EAAeC,EAAczC,GACnCG,EAASqC,GACTE,EAAeF,KAIjB,MAAMG,EAASC,SAASC,cAAc,UACtCF,EAAOG,IAAM,wCACbH,EAAO1B,OAAQ,EAEf2B,SAASG,KAAKC,YAAYL,GAE1BzD,OAAO+D,6BAA+B,MACpC,MAAMvC,EAAS,IAAIxB,OAAOgE,QAAQC,OAAO,CACvCC,KAAM,mBACNC,cAAgBC,IACdA,EAAGvC,MAIPL,EAAO6C,YAAY,QAASC,IAAmB,IAAlBC,UAAEA,GAAWD,EACxC3C,EAAY4C,GACZpB,QAAQqB,IAAI,uBAAwBD,KAGtC/C,EAAO6C,YAAY,YAAaI,IAAmB,IAAlBF,UAAEA,GAAWE,EAC5CtB,QAAQqB,IAAI,6BAA8BD,KAG5C/C,EAAOkD,UACPjD,EAAUD,OAGb,IAEHI,oBAAU,KACR,MAAM+C,EAAa7D,EAAM8D,OACnBC,EAAgB/D,EAAMgE,OAAQhC,GAASA,EAAKE,UAAU4B,OAE5DvD,EADoBwD,EAAgBF,EAAc,MAEjD,CAAC7D,IAEJc,oBAAU,KACR,MAAM1B,EAAOH,IACboD,QAAQqB,IAAI,kBAAmBtE,EAAK4B,cACpC9B,OAAOC,SAASC,KAAO,GACvB,MAAM2B,EAAS3B,EAAK4B,aAChBD,IACFjB,EAASiB,GACTsB,QAAQqB,IAAI,kBAAmB3C,KAGhC,IAGH,MAAM0B,EAAiBzC,IACrB,MAAME,EAAQ,GACd,IAAK,IAAI+D,EAAI,EAAGA,EAAIjE,EAAM8D,OAAS,EAAGG,IACpC,IAAK,IAAIC,EAAID,EAAI,EAAGC,EAAIlE,EAAM8D,OAAQI,IACpChE,EAAMiE,KAAK,CAACnE,EAAMiE,GAAIjE,EAAMkE,KAGhC,OAAOhE,GAGHwC,EAAkBxC,IACtB,MAAMkE,EAAiBlE,EAAM8D,OAC1BK,IAAUA,EAAK,GAAGnC,WAAamC,EAAK,GAAGnC,UAE1C,GAA8B,IAA1BkC,EAAeN,OAEjB,YADArD,GAAgB,GAGlB,MAAM6D,EAAcC,KAAKC,MAAMD,KAAKE,SAAWL,EAAeN,QAC9DzD,EAAe+D,EAAeE,IAC9BnE,EAASD,EAAM8D,OAAQK,GAASA,IAASD,EAAeE,MAGpDI,EAAeA,CAACC,EAAQC,KAC5B,MAAMC,EAAe7E,EAAM+B,IAAKC,GAC9BA,EAAKC,MAAM6C,KAAOH,EAAO1C,MAAM6C,GAC3B,IAAK9C,EAAME,UAAU,EAAMC,MAAOH,EAAKG,MAAQ,GAAK,GACpDH,GAEN/B,EAAS4E,GACTnC,EAAexC,IAmCjB,OACE6E,IAAAlC,cAAA,OAAKmC,UAAU,OACbD,IAAAlC,cAAA,OAAKmC,UAAU,UAAS,mBAEtBnF,EAGAkF,IAAAlC,cAAAkC,IAAAE,SAAA,KACEF,IAAAlC,cAAA,OAAKmC,UAAU,qBAAoB,sBACbhF,EAAM8D,QAG3BtD,EACCuE,IAAAlC,cAAA,OAAKmC,UAAU,gBACbD,IAAAlC,cAAA,UAAI,gBACJkC,IAAAlC,cAAA,aACEkC,IAAAlC,cAAA,aACEkC,IAAAlC,cAAA,UACEkC,IAAAlC,cAAA,UAAI,QACJkC,IAAAlC,cAAA,UAAI,eAGRkC,IAAAlC,cAAA,aApCIqC,MAChB,MAAMC,EAASnF,EAAMoF,KAAK,CAACC,EAAGC,KAAOA,EAAEnD,MAAQ,IAAMkD,EAAElD,MAAQ,IAC/D,IAAIoD,EAAO,EAOX,OANAJ,EAAOK,QAAQ,CAACxD,EAAMyD,KAChBA,EAAQ,IAAMzD,EAAKG,MAAQ,MAAQgD,EAAOM,EAAQ,GAAGtD,MAAQ,KAC/DoD,EAAOE,EAAQ,GAEjBzD,EAAKuD,KAAOA,IAEPJ,GA4BQD,GAAYnD,IAAKC,GAChB+C,IAAAlC,cAAA,MAAI6C,IAAK1D,EAAKC,MAAM6C,IAClBC,IAAAlC,cAAA,UAAKb,EAAKuD,MACVR,IAAAlC,cAAA,UAAKb,EAAKC,MAAMmB,WAO1B2B,IAAAlC,cAAAkC,IAAAE,SAAA,KACG7E,EAAY,IAAMA,EAAY,GAC7B2E,IAAAlC,cAAAkC,IAAAE,SAAA,KACEF,IAAAlC,cAAA,OAAKmC,UAAU,kBACbD,IAAAlC,cAAA,OACEmC,UAAU,OACVW,QAASA,IACPjB,EAAatE,EAAY,GAAIA,EAAY,KAG3C2E,IAAAlC,cAAA,OACEC,IAAK1C,EAAY,GAAG6B,MAAM2D,MAAMC,OAAO,GAAGC,IAC1CC,IAAK3F,EAAY,GAAG6B,MAAMmB,OAE5B2B,IAAAlC,cAAA,WAAMzC,EAAY,GAAG6B,MAAMmB,OAE7B2B,IAAAlC,cAAA,OACEmC,UAAU,OACVW,QAASA,IACPjB,EAAatE,EAAY,GAAIA,EAAY,KAG3C2E,IAAAlC,cAAA,OACEC,IAAK1C,EAAY,GAAG6B,MAAM2D,MAAMC,OAAO,GAAGC,IAC1CC,IAAK3F,EAAY,GAAG6B,MAAMmB,OAE5B2B,IAAAlC,cAAA,WAAMzC,EAAY,GAAG6B,MAAMmB,QAI/B2B,IAAAlC,cAAA,OAAKmC,UAAU,sBACbD,IAAAlC,cAAA,OAAKmC,UAAU,gBACbD,IAAAlC,cAAA,OACEmC,UAAU,WACVgB,MAAO,CAAEC,MAAK,GAAAlH,OAAKuB,EAAQ,OAE1BiE,KAAK2B,MAAM5F,GAAU,OAK5ByE,IAAAlC,cAAA,OAAKmC,UAAU,WACbD,IAAAlC,cAAA,OAAKmC,UAAU,qBACbD,IAAAlC,cAAA,UAAQ8C,QA5GVQ,KAChB,MAAMtB,EAAe7E,EAAM+B,IAAKC,GAE5BA,EAAKC,MAAM6C,KAAO1E,EAAY,GAAG6B,MAAM6C,IACvC9C,EAAKC,MAAM6C,KAAO1E,EAAY,GAAG6B,MAAM6C,GAEhC,IAAK9C,EAAME,UAAU,EAAMC,MAAOH,EAAKG,MAAQ,GAAK,GAEtDH,GAET/B,EAAS4E,GACTnC,EAAexC,KAiG+B,iBAE9B6E,IAAAlC,cAAA,UAAQ8C,QAhGFS,KACtB3F,GAAgB,KA+FkC,uBAItCsE,IAAAlC,cAAA,WAAK,gBA7EbkC,IAAAlC,cAAA,KAAGwD,KAAMvH,GAAU,sBCxIZwH,MAZSC,IAClBA,GAAeA,aAAuBC,UACxCC,EAAAC,EAAA,GAAAnE,KAAAkE,EAAAE,KAAA,UAAqBpE,KAAKiB,IAAiD,IAAhDoD,OAAEA,EAAMC,OAAEA,EAAMC,OAAEA,EAAMC,OAAEA,EAAMC,QAAEA,GAASxD,EACpEoD,EAAOL,GACPM,EAAON,GACPO,EAAOP,GACPQ,EAAOR,GACPS,EAAQT,MCDDU,IAASC,WAAWtE,SAASuE,eAAe,SACpDC,OACHrC,IAAAlC,cAACkC,IAAMsC,WAAU,KACftC,IAAAlC,cAACjD,EAAG,QAOR0G","file":"static/js/main.3304b5a1.chunk.js","sourcesContent":["// spotify.js\r\n\r\nconst AUTH_ENDPOINT = 'https://accounts.spotify.com/authorize';\r\nconst REDIRECT_URI = 'https://korsawat.github.io/Song/';\r\nconst CLIENT_ID = \"e09c3389cd8f4a0c92f03e1bc5b423c2\"; // Replace with your Spotify client ID\r\nconst SCOPES = [\r\n  'user-library-read', \r\n];\r\n\r\nexport const loginUrl = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&scope=${SCOPES.join(\r\n  '%20'\r\n)}&response_type=token&show_dialog=true`;\r\n\r\nexport const getTokenFromUrl = () => {\r\n  return window.location.hash.substring(1).split('&').reduce((initial, item) => {\r\n    let parts = item.split('=');\r\n    initial[parts[0]] = decodeURIComponent(parts[1]);\r\n    return initial;\r\n  }, {});\r\n};\r\n\r\nexport const getLikedSongs = async (token) => {\r\n  const limit = 50; // Number of items to fetch per request\r\n  let offset = 0;\r\n  let allSongs = [];\r\n\r\n  try {\r\n    let data;\r\n    \r\n    do {\r\n      const response = await fetch(`https://api.spotify.com/v1/me/tracks?limit=${limit}&offset=${offset}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n  \r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! Status: ${response.status}`);\r\n      }\r\n  \r\n      data = await response.json();\r\n      allSongs = [...allSongs, ...data.items];\r\n      offset += limit;\r\n    } while (offset < data.total);\r\n  \r\n    return allSongs.map((song) => ({\r\n      track: song.track,\r\n      compared: false,\r\n      wins: 0,\r\n    }));\r\n  } catch (error) {\r\n    console.error('Error fetching liked songs:', error);\r\n    throw error; // Re-throw the error to handle it further up the call stack\r\n  }\r\n};\r\n","import React, { useState, useEffect } from \"react\";\nimport { loginUrl, getTokenFromUrl, getLikedSongs } from \"./spotify\";\nimport \"./App.css\";\n\nconst App = () => {\n  const [token, setToken] = useState(\"\");\n  const [songs, setSongs] = useState([]);\n  const [pairs, setPairs] = useState([]);\n  const [currentPair, setCurrentPair] = useState([null, null]);\n  const [progress, setProgress] = useState(0);\n  const [showRankings, setShowRankings] = useState(false);\n  const [player, setPlayer] = useState(null);\n  const [deviceId, setDeviceId] = useState(\"\");\n\n  useEffect(() => {\n    const hash = getTokenFromUrl();\n    window.location.hash = \"\";\n    const _token = hash.access_token;\n    if (_token) {\n      setToken(_token);\n      getLikedSongs(_token).then((songs) => {\n        setSongs(songs.map((song) => ({ ...song, compared: false })));\n        setProgress(0);\n        const initialPairs = generatePairs(songs);\n        setPairs(initialPairs);\n        pickRandomPair(initialPairs);\n      });\n\n      // Initialize Spotify Player\n      const script = document.createElement(\"script\");\n      script.src = \"https://sdk.scdn.co/spotify-player.js\";\n      script.async = true;\n\n      document.body.appendChild(script);\n\n      window.onSpotifyWebPlaybackSDKReady = () => {\n        const player = new window.Spotify.Player({\n          name: \"Web Playback SDK\",\n          getOAuthToken: (cb) => {\n            cb(_token);\n          },\n        });\n\n        player.addListener(\"ready\", ({ device_id }) => {\n          setDeviceId(device_id);\n          console.log(\"Ready with Device ID\", device_id);\n        });\n\n        player.addListener(\"not_ready\", ({ device_id }) => {\n          console.log(\"Device ID has gone offline\", device_id);\n        });\n\n        player.connect();\n        setPlayer(player);\n      };\n    }\n  }, []);\n\n  useEffect(() => {\n    const totalSongs = songs.length;\n    const comparedSongs = songs.filter((song) => song.compared).length;\n    const percentage = (comparedSongs / totalSongs) * 100;\n    setProgress(percentage);\n  }, [songs]);\n\n  useEffect(() => {\n    const hash = getTokenFromUrl();\n    console.log('Token from URL:', hash.access_token); // Log the token immediately after retrieval\n    window.location.hash = \"\";\n    const _token = hash.access_token;\n    if (_token) {\n      setToken(_token);\n      console.log('Token in state:', _token); // Log the token after storing it in state\n      // Rest of your code...\n    }\n  }, []);\n  \n\n  const generatePairs = (songs) => {\n    const pairs = [];\n    for (let i = 0; i < songs.length - 1; i++) {\n      for (let j = i + 1; j < songs.length; j++) {\n        pairs.push([songs[i], songs[j]]);\n      }\n    }\n    return pairs;\n  };\n\n  const pickRandomPair = (pairs) => {\n    const remainingPairs = pairs.filter(\n      (pair) => !pair[0].compared || !pair[1].compared\n    );\n    if (remainingPairs.length === 0) {\n      setShowRankings(true);\n      return;\n    }\n    const randomIndex = Math.floor(Math.random() * remainingPairs.length);\n    setCurrentPair(remainingPairs[randomIndex]);\n    setPairs(pairs.filter((pair) => pair !== remainingPairs[randomIndex]));\n  };\n\n  const handleChoice = (winner, loser) => {\n    const updatedSongs = songs.map((song) =>\n      song.track.id === winner.track.id\n        ? { ...song, compared: true, wins: (song.wins || 0) + 1 }\n        : song\n    );\n    setSongs(updatedSongs);\n    pickRandomPair(pairs);\n  };\n\n  const handleTie = () => {\n    const updatedSongs = songs.map((song) => {\n      if (\n        song.track.id === currentPair[0].track.id ||\n        song.track.id === currentPair[1].track.id\n      ) {\n        return { ...song, compared: true, wins: (song.wins || 0) + 1 };\n      }\n      return song;\n    });\n    setSongs(updatedSongs);\n    pickRandomPair(pairs);\n  };\n\n  const showRankedSongs = () => {\n    setShowRankings(true);\n  };\n\n  const rankSongs = () => {\n    const ranked = songs.sort((a, b) => (b.wins || 0) - (a.wins || 0));\n    let rank = 1;\n    ranked.forEach((song, index) => {\n      if (index > 0 && (song.wins || 0) !== (ranked[index - 1].wins || 0)) {\n        rank = index + 1;\n      }\n      song.rank = rank;\n    });\n    return ranked;\n  };\n\n\n\n  return (\n    <div className=\"App\">\n      <div className=\"header\">Song Comparison</div>\n\n      {!token ? (\n        <a href={loginUrl}>Login to Spotify</a>\n      ) : (\n        <>\n          <div className=\"total-liked-songs\">\n            Total Liked Songs: {songs.length}\n          </div>\n\n          {showRankings ? (\n            <div className=\"ranked-songs\">\n              <h2>Ranked Songs</h2>\n              <table>\n                <thead>\n                  <tr>\n                    <th>Rank</th>\n                    <th>Song Name</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rankSongs().map((song) => (\n                    <tr key={song.track.id}>\n                      <td>{song.rank}</td>\n                      <td>{song.track.name}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          ) : (\n            <>\n              {currentPair[0] && currentPair[1] ? (\n                <>\n                  <div className=\"song-container\">\n                    <div\n                      className=\"song\"\n                      onClick={() =>\n                        handleChoice(currentPair[0], currentPair[1])\n                      }\n                    >\n                      <img\n                        src={currentPair[0].track.album.images[0].url}\n                        alt={currentPair[0].track.name}\n                      />\n                      <div>{currentPair[0].track.name}</div>\n                    </div>\n                    <div\n                      className=\"song\"\n                      onClick={() =>\n                        handleChoice(currentPair[1], currentPair[0])\n                      }\n                    >\n                      <img\n                        src={currentPair[1].track.album.images[0].url}\n                        alt={currentPair[1].track.name}\n                      />\n                      <div>{currentPair[1].track.name}</div>\n                    </div>\n                  </div>\n\n                  <div className=\"progress-container\">\n                    <div className=\"progress-bar\">\n                      <div\n                        className=\"progress\"\n                        style={{ width: `${progress}%` }}\n                      >\n                        {Math.round(progress)}%\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"buttons\">\n                    <div className=\"buttons-container\">\n                      <button onClick={handleTie}>Can't Decide</button>\n                    </div>\n                    <button onClick={showRankedSongs}>Show Ranked Songs</button>\n                  </div>\n                </>\n              ) : (\n                <div>Loading...</div>\n              )}\n            </>\n          )}\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nconst root = ReactDOM.createRoot(document.getElementById('root'));\nroot.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}