(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(e,t,a){},14:function(e,t,a){},15:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(3),s=a.n(r),o=(a(13),a(1)),l=a.n(o);const i=e=>{l.a.set("spotify_access_token",e,{expires:30})},m=()=>{l.a.remove("spotify_access_token")},u="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("e09c3389cd8f4a0c92f03e1bc5b423c2","&redirect_uri=").concat("https://korsawat.github.io/Song/","&scope=").concat(["user-library-read"].join("%20"),"&response_type=token&show_dialog=true");a(14);var d=()=>{const[e,t]=Object(n.useState)(""),[a,r]=Object(n.useState)([]),[s,o]=Object(n.useState)([]),[d,g]=Object(n.useState)([null,null]),[E,h]=Object(n.useState)(0),[k,p]=Object(n.useState)(!1);Object(n.useEffect)(()=>{const e=l.a.get("spotify_access_token");e?(t(e),w(e)):f()},[]),Object(n.useEffect)(()=>{const e=a.length,t=a.filter(e=>e.compared).length;h(e>0?t/e*100:0)},[a]);const f=()=>{const e=(()=>{const e=window.location.hash.substring(1),t=new URLSearchParams(e).get("access_token");return t&&i(t),{access_token:t}})();window.location.hash="";const a=e.access_token;a&&(t(a),i(a),w(a))},w=async e=>{try{const a=await(async e=>{let t,a=0,n=[];try{do{const c="https://api.spotify.com/v1/me/tracks?limit=50&offset="+a,r={Authorization:"Bearer "+e},s=await fetch(c,{headers:r});if(!s.ok){const e=await s.text();throw console.error("Response Status:",s.status),console.error("Response Text:",e),403===s.status?new Error("Access forbidden. Check Spotify API permissions."):new Error("HTTP error! Status: ".concat(s.status))}t=await s.json(),n=n.concat(t.items),a+=50}while(a<t.total)}catch(c){throw console.error("Error fetching songs:",c.message),c}return n.map(e=>({track:e.track,compared:!1,wins:0}))})(e);r(a.map(e=>({...e,compared:!1}))),h(0);const n=b(a);o(n),v(n)}catch(t){console.error("Error fetching songs:",t.message),m()}},b=e=>{const t=[];for(let a=0;a<e.length-1;a++)for(let n=a+1;n<e.length;n++)t.push([e[a],e[n]]);return t},v=e=>{const t=e.filter(e=>!e[0].compared||!e[1].compared);if(0===t.length)return void p(!0);const a=Math.floor(Math.random()*t.length);g(t[a]),o(e.filter(e=>e!==t[a]))},S=(e,t)=>{const n=a.map(t=>t.track.id===e.track.id?{...t,compared:!0,wins:(t.wins||0)+1}:t);r(n),v(s)},y=()=>{m(),t(""),r([]),o([]),g([null,null]),h(0),p(!1)};return c.a.createElement("div",{className:"App"},c.a.createElement("div",{className:"header"},"Song Comparison"),e?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"total-liked-songs"},"Total Liked Songs: ",a.length),k?c.a.createElement("div",{className:"ranked-songs"},c.a.createElement("h2",null,"Ranked Songs"),c.a.createElement("table",null,c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"Rank"),c.a.createElement("th",null,"Song Name"))),c.a.createElement("tbody",null,(()=>{const e=a.sort((e,t)=>(t.wins||0)-(e.wins||0));let t=1;return e.forEach((a,n)=>{n>0&&(a.wins||0)!==(e[n-1].wins||0)&&(t=n+1),a.rank=t}),e})().map(e=>c.a.createElement("tr",{key:e.track.id},c.a.createElement("td",null,e.rank),c.a.createElement("td",null,e.track.name))))),c.a.createElement("div",{className:"buttons"},c.a.createElement("div",{className:"buttons-container"},c.a.createElement("button",{onClick:y},"Logout")))):c.a.createElement(c.a.Fragment,null,d[0]&&d[1]?c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"song-container"},c.a.createElement("div",{className:"song",onClick:()=>S(d[0],d[1])},c.a.createElement("img",{src:d[0].track.album.images[0].url,alt:d[0].track.name}),c.a.createElement("div",null,d[0].track.name)),c.a.createElement("div",{className:"song",onClick:()=>S(d[1],d[0])},c.a.createElement("img",{src:d[1].track.album.images[0].url,alt:d[1].track.name}),c.a.createElement("div",null,d[1].track.name))),c.a.createElement("div",{className:"progress-container"},c.a.createElement("div",{className:"progress-bar"},c.a.createElement("div",{className:"progress",style:{width:"".concat(E,"%")}},Math.round(E),"%"))),c.a.createElement("div",{className:"buttons"},c.a.createElement("div",{className:"buttons-container"},c.a.createElement("button",{onClick:()=>{const e=a.map(e=>e.track.id===d[0].track.id||e.track.id===d[1].track.id?{...e,compared:!0,wins:(e.wins||0)+1}:e);r(e),v(s)}},"Can't Decide")),c.a.createElement("button",{onClick:()=>{p(!0)}},"Show Ranked Songs"),c.a.createElement("button",{onClick:y},"Logout"))):c.a.createElement("div",null,"Loading..."))):c.a.createElement("a",{href:u},"Login to Spotify"))};var g=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,16)).then(t=>{let{getCLS:a,getFID:n,getFCP:c,getLCP:r,getTTFB:s}=t;a(e),n(e),c(e),r(e),s(e)})};s.a.createRoot(document.getElementById("root")).render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(d,null))),g()},4:function(e,t,a){e.exports=a(15)}},[[4,1,2]]]);
//# sourceMappingURL=main.b0193b19.chunk.js.map